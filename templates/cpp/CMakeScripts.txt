cmake_minimum_required(VERSION 2.8)

# custom directories
set(BUILD_DIR Products)
set(TEMPLATES_DIR templates/cpp)
set(CHECKERS_DIR templates)

# problems

set(time_limit @time_limit@)
set(memory_limit @memory_limit@)
set(input_file_name @input_file_name@)
set(output_file_name @output_file_name@)

if(@test_type_changed@)
  configure_file(${TEMPLATES_DIR}/source_@test_type@.cpp @problem_dir@/source.cpp)
endif()

if(@time_limit_changed@ OR @memory_limit_changed@)
  configure_file(${TEMPLATES_DIR}/limits.cpp @problem_dir@/limits.cpp)
endif()

if(@input_file_name_changed@ OR @output_file_name_changed@)
  configure_file(${TEMPLATES_DIR}/main.cpp @problem_dir@/main.cpp)
endif()

# problems
# checkers compilation is performed last because it's a slow process
# problems

if(NOT @custom_checker@)
  if(@custom_checker_changed@ OR @checker_compiler_options_changed@)
    set(BINARY_DIR ${BUILD_DIR}/RelWithDebInfo)
    file(MAKE_DIRECTORY ${BINARY_DIR})
    execute_process(COMMAND g++ @checker_compiler_options@
      -o ${BINARY_DIR}/@problem_id@Checker
      ${CHECKERS_DIR}/default_checker.cpp)
  endif()
endif()
